# Firehose Go Data Pipeline

This is the Go-based data aggregation pipeline for The Firehose CNCF release aggregator.

## Architecture

**Hybrid Approach:** Go backend (data pipeline) + Astro frontend (UI rendering)

### What Go Does
- Fetches CNCF Landscape metadata (landscape.yml)
- Fetches 231 RSS/Atom feeds in parallel with goroutines
- Enriches releases with CNCF project metadata
- Validates and normalizes data
- Outputs JSON for Astro to consume

### What Astro Does
- Imports JSON data (generated by Go)
- Renders static HTML with existing components
- Provides search (Pagefind), filters, keyboard nav
- Deploys to GitHub Pages

## Project Structure

```
firehose-go/
├── cmd/
│   └── firehose/
│       └── main.go              # CLI entry point
├── internal/
│   ├── feeds/
│   │   └── feeds.go             # Parallel feed fetching
│   ├── landscape/
│   │   └── landscape.go         # CNCF Landscape integration
│   ├── models/
│   │   └── models.go            # Data structures
│   └── output/
│       └── output.go            # Output utilities
├── config/
│   └── feeds.yaml               # 231 feed URLs (generated from feeds.ts)
├── go.mod                       # Go module definition
├── go.sum                       # Dependency checksums
└── README.md                    # This file
```

## Dependencies

- **gopkg.in/yaml.v3** - YAML parsing for landscape.yml and feeds.yaml
- **github.com/mmcdole/gofeed** - RSS/Atom feed parsing

## Building

```bash
# Install dependencies
go mod download

# Build binary
go build -o firehose ./cmd/firehose

# Run
./firehose
```

Output: `../src/data/releases.json` (~7MB, used by Astro)

## Performance

**Expected:**
- Landscape fetch: ~1s
- 231 feeds (parallel): ~3-5s (vs 8-10s in Node.js)
- Total: ~4-6s (vs 10-15s in Node.js)

**Parallelism:** Goroutines + channels for true concurrent execution

## Data Flow

1. **Fetch Landscape** → Parse 867 CNCF projects from landscape.yml
2. **Fetch Feeds** → Parallel fetch of 231 GitHub release feeds
3. **Enrich** → Match feeds to Landscape projects, add metadata
4. **Validate** → Ensure required fields present
5. **Sort** → Order by pubDate descending
6. **Output** → Write JSON to `../src/data/releases.json`

## JSON Schema

Output conforms to [JSON-SCHEMA.md](../.planning/go-port/JSON-SCHEMA.md):

```json
{
  "metadata": {
    "schemaVersion": "1.0.0",
    "generatedAt": "2026-02-02T10:15:30Z",
    "generatedBy": "firehose-go v1.0.0",
    "stats": { ... },
    "performance": { ... }
  },
  "releases": [ ... ],
  "feeds": [ ... ]
}
```

## Error Handling

- **Transient errors** (5xx, timeout): NOT IMPLEMENTED YET - will add retry with exponential backoff
- **Permanent errors** (404, 403): Fail fast, log, continue with other feeds
- **Graceful degradation**: Build succeeds if >50% feeds load successfully
- **Feed status tracking**: Each feed has status (success/error) for monitoring

## Testing

```bash
# Run tests
go test ./...

# Test equivalence with Node.js pipeline
go run ./cmd/firehose
cd .. && npm run build
# Compare output with current build
```

## Future Enhancements

- [ ] Retry logic for transient errors
- [ ] Rate limiting for GitHub API
- [ ] Caching (optional, for local development)
- [ ] Compression (gzip output)
- [ ] Validation with go-playground/validator
- [ ] Structured logging (zerolog or zap)
- [ ] Prometheus metrics
- [ ] Unit tests
- [ ] Integration tests

## References

- JSON Schema: `../.planning/go-port/JSON-SCHEMA.md`
- Architecture: `../.planning/codebase/ARCHITECTURE.md`
- Data Flow: `../.planning/codebase/DATAFLOW.md`
- Current Node.js implementation: `../src/lib/feed-loader.ts`, `../src/lib/landscape.ts`

## License

MIT (same as parent project)
