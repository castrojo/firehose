name: Update CNCF Project Logos

on:
  schedule:
    # Weekly on Sundays at 3 AM UTC (low traffic time)
    - cron: "0 3 * * 0"
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  update-logos:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v4

      - name: Run logo update script
        run: |
          chmod +x scripts/update-logos.sh
          ./scripts/update-logos.sh

      - name: Check for changes
        id: git-check
        run: |
          git diff --exit-code public/logos/ || echo "has_changes=true" >> $GITHUB_OUTPUT

      - name: Create Pull Request
        if: steps.git-check.outputs.has_changes == 'true'
        uses: peter-evans/create-pull-request@v8
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: update CNCF project logos from artwork repository"
          branch: automated/logo-updates
          delete-branch: true
          title: "chore: Update CNCF project logos"
          body: |
            ## Automated Logo Update
            
            This PR updates CNCF project logos from the [cncf/artwork](https://github.com/cncf/artwork) repository.
            
            ### Changes
            - Downloads missing logos for newly added projects
            - Updates existing logos if they've changed upstream
            - No API rate limits (uses direct file downloads)
            
            ### What to review
            - Verify new logo files are valid SVGs
            - Check that no logos were accidentally deleted
            - Ensure logo quality is acceptable
            
            ### Merge strategy
            This PR is safe to merge automatically if the CI build passes, as:
            - Logos are non-functional assets (won't break the site)
            - Missing logos gracefully degrade (hidden via CSS)
            - The build process validates SVG files
            
            Generated by: `.github/workflows/update-logos.yaml`
            
            Assisted-by: Automated workflow
          labels: |
            automated
            logos
            maintenance
