---
phase: 03-user-interface
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/ErrorBanner.astro
  - src/pages/index.astro
autonomous: true

must_haves:
  truths:
    - "Failed feeds are visible to user (not silently ignored)"
    - "User can see which feeds failed and why"
    - "Error banner is dismissible (doesn't block content)"
    - "Page is usable on mobile devices (320px width minimum)"
  artifacts:
    - path: "src/components/ErrorBanner.astro"
      provides: "Failed feed notification UI"
      min_lines: 40
    - path: "src/pages/index.astro"
      provides: "Responsive design breakpoints"
      contains: "@media"
  key_links:
    - from: "src/components/ErrorBanner.astro"
      to: "errorEntries"
      via: "displays failed feeds"
      pattern: "feedStatus.*error"
    - from: "src/pages/index.astro"
      to: "ErrorBanner"
      via: "conditionally renders banner"
      pattern: "errorCount > 0"
---

<objective>
Display failed feeds prominently so users know when data is incomplete, and ensure the site is fully responsive on mobile devices down to 320px width.

Purpose: Silent failures degrade trust—users should know if feeds failed. Mobile users are a significant portion of traffic and must have a usable experience.

Output: Dismissible error banner showing failed feeds, and responsive CSS that works on all screen sizes.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-user-interface/03-01-PLAN.md
@src/pages/index.astro
@src/lib/schemas.ts
</context>

<tasks>

<task type="auto">
  <name>Create ErrorBanner component with dismissible UI</name>
  <files>src/components/ErrorBanner.astro</files>
  <action>
Create `src/components/ErrorBanner.astro` to display failed feeds:

```astro
---
interface ErrorEntry {
  projectName?: string;
  feedUrl: string;
  feedError?: string;
  feedErrorType?: string;
}

interface Props {
  errors: ErrorEntry[];
}

const { errors } = Astro.props;
const errorCount = errors.length;
---

{errorCount > 0 && (
  <div class="error-banner" id="error-banner">
    <div class="error-banner-header">
      <div class="error-banner-title">
        <svg class="icon-warning" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path>
        </svg>
        <span>
          <strong>{errorCount} feed{errorCount === 1 ? '' : 's'} failed to load</strong>
        </span>
      </div>
      <button class="error-banner-toggle" aria-label="Toggle error details" aria-expanded="false">
        <span class="toggle-text">Show details</span>
        <svg class="icon-chevron" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
          <path d="M6 8.825l3.825-3.825 .7.7L6 10.225 1.475 5.7l.7-.7L6 8.825z"></path>
        </svg>
      </button>
      <button class="error-banner-dismiss" aria-label="Dismiss banner">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
          <path d="M1.757 10.243a.75.75 0 1 0 1.06 1.06L6 8.12l3.182 3.182a.75.75 0 0 0 1.061-1.06L7.061 7.06l3.182-3.182a.75.75 0 1 0-1.06-1.061L6 5.939 2.818 2.757a.75.75 0 1 0-1.061 1.06L4.939 6.94 1.757 10.243z"></path>
        </svg>
      </button>
    </div>
    
    <div class="error-banner-details" id="error-details" style="display: none;">
      <ul class="error-list">
        {errors.map((error) => (
          <li class="error-item">
            <strong class="error-project">{error.projectName || 'Unknown Project'}</strong>
            <code class="error-url">{error.feedUrl}</code>
            {error.feedError && (
              <p class="error-message">
                <span class="error-type">[{error.feedErrorType || 'error'}]</span> {error.feedError}
              </p>
            )}
          </li>
        ))}
      </ul>
      <p class="error-footer">
        The site will continue to work with partial data. Failed feeds will be retried on the next build.
      </p>
    </div>
  </div>
)}

<script>
  // Error banner toggle and dismiss logic
  (function() {
    const banner = document.getElementById('error-banner');
    const toggle = banner?.querySelector('.error-banner-toggle');
    const dismiss = banner?.querySelector('.error-banner-dismiss');
    const details = document.getElementById('error-details');
    const toggleText = banner?.querySelector('.toggle-text');
    const chevron = banner?.querySelector('.icon-chevron');
    
    if (!banner || !toggle || !dismiss || !details) return;
    
    // Toggle details
    toggle.addEventListener('click', () => {
      const isExpanded = details.style.display !== 'none';
      details.style.display = isExpanded ? 'none' : 'block';
      toggle.setAttribute('aria-expanded', String(!isExpanded));
      if (toggleText) toggleText.textContent = isExpanded ? 'Show details' : 'Hide details';
      if (chevron) chevron.style.transform = isExpanded ? 'rotate(0deg)' : 'rotate(180deg)';
    });
    
    // Dismiss banner
    dismiss.addEventListener('click', () => {
      banner.style.display = 'none';
      // Store dismiss state in localStorage
      localStorage.setItem('errorBannerDismissed', 'true');
    });
    
    // Check if banner was previously dismissed
    if (localStorage.getItem('errorBannerDismissed') === 'true') {
      banner.style.display = 'none';
    }
  })();
</script>

<style>
  .error-banner {
    background: #fff8c5;
    border: 1px solid #d4a72c;
    border-radius: 6px;
    padding: 1rem;
    margin-bottom: 1.5rem;
  }
  
  .error-banner-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
  }
  
  .error-banner-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex: 1;
  }
  
  .icon-warning {
    color: #9a6700;
    flex-shrink: 0;
  }
  
  .error-banner-title span {
    color: #4d2d00;
  }
  
  .error-banner-toggle {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    background: none;
    border: none;
    color: #4d2d00;
    font-size: 0.875rem;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    transition: background-color 0.2s;
  }
  
  .error-banner-toggle:hover {
    background: rgba(0, 0, 0, 0.05);
  }
  
  .icon-chevron {
    transition: transform 0.2s;
  }
  
  .error-banner-dismiss {
    background: none;
    border: none;
    color: #4d2d00;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    display: flex;
    align-items: center;
    transition: background-color 0.2s;
    flex-shrink: 0;
  }
  
  .error-banner-dismiss:hover {
    background: rgba(0, 0, 0, 0.05);
  }
  
  .error-banner-details {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #d4a72c;
  }
  
  .error-list {
    list-style: none;
    padding: 0;
    margin: 0 0 1rem 0;
  }
  
  .error-item {
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 4px;
    margin-bottom: 0.5rem;
  }
  
  .error-project {
    display: block;
    color: #4d2d00;
    margin-bottom: 0.25rem;
  }
  
  .error-url {
    display: block;
    font-size: 0.75rem;
    color: #6e4c00;
    background: rgba(0, 0, 0, 0.05);
    padding: 0.125rem 0.25rem;
    border-radius: 3px;
    word-break: break-all;
    font-family: ui-monospace, 'Cascadia Code', Consolas, monospace;
    margin-bottom: 0.5rem;
  }
  
  .error-message {
    font-size: 0.875rem;
    color: #6e4c00;
    margin: 0;
  }
  
  .error-type {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
  }
  
  .error-footer {
    font-size: 0.875rem;
    color: #6e4c00;
    margin: 0;
    font-style: italic;
  }
  
  /* Mobile responsive */
  @media (max-width: 640px) {
    .error-banner-header {
      flex-wrap: wrap;
    }
    
    .toggle-text {
      display: none;
    }
    
    .error-banner-title span strong {
      font-size: 0.875rem;
    }
  }
</style>
```

**Design decisions:**
- Yellow background (warning, not error - site still works)
- Collapsible details (don't overwhelm user)
- Dismissible (localStorage persists across sessions)
- Shows project name, feed URL, error type, error message
- Reassures user that site works with partial data
  </action>
  <verify>
```bash
# Check component exists
ls src/components/ErrorBanner.astro && echo "✅ ErrorBanner component created"

# Verify key elements
grep -q "error-banner" src/components/ErrorBanner.astro && echo "✅ Banner structure present"
grep -q "error-banner-toggle" src/components/ErrorBanner.astro && echo "✅ Toggle implemented"
grep -q "localStorage" src/components/ErrorBanner.astro && echo "✅ Dismiss persistence"
```
  </verify>
  <done>
- ErrorBanner.astro created with collapsible details
- Toggle button expands/collapses error list
- Dismiss button hides banner (persists in localStorage)
- Shows error count, project names, URLs, error messages
- Styled with yellow warning theme
- Responsive on mobile (hides "Show details" text, keeps icon)
  </done>
</task>

<task type="auto">
  <name>Integrate ErrorBanner into index.astro and add responsive CSS</name>
  <files>src/pages/index.astro</files>
  <action>
Update `src/pages/index.astro` to:
1. Use ErrorBanner component
2. Pass error entries to banner
3. Add responsive CSS breakpoints for mobile devices (320px-768px)

**Add to imports:**
```astro
import ErrorBanner from '../components/ErrorBanner.astro';
```

**Add after stats bar, before infinite scroll container:**
```astro
<!-- Error banner (if any feeds failed) -->
{errorCount > 0 && (
  <ErrorBanner errors={errorEntries} />
)}
```

**Add to frontmatter (after sortedReleases):**
```astro
// Get error entries for error banner
const errorEntries = releases
  .filter(r => r.data.feedStatus === 'error')
  .map(r => ({
    projectName: r.data.projectName || r.data.feedTitle,
    feedUrl: r.data.feedUrl,
    feedError: r.data.feedError,
    feedErrorType: r.data.feedErrorType,
  }));
```

**Add responsive CSS to existing `<style>` block:**
```css
/* Mobile-first responsive design */

/* Tablet (768px and below) */
@media (max-width: 768px) {
  .site-title {
    font-size: 1.5rem;
  }
  
  .site-subtitle {
    font-size: 0.875rem;
  }
  
  .stats {
    grid-template-columns: repeat(2, 1fr);
    padding: 1rem;
  }
  
  .stat-value {
    font-size: 1.5rem;
  }
  
  .stat-label {
    font-size: 0.75rem;
  }
}

/* Mobile landscape (640px and below) */
@media (max-width: 640px) {
  .container {
    padding: 0 0.75rem;
  }
  
  .site-header {
    padding: 1.5rem 0;
  }
  
  .site-title {
    font-size: 1.25rem;
  }
}

/* Mobile portrait (480px and below) */
@media (max-width: 480px) {
  .stats {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }
  
  .stat {
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--color-border-default);
  }
  
  .stat:last-child {
    border-bottom: none;
  }
}

/* Small mobile (320px - minimum supported) */
@media (max-width: 320px) {
  .container {
    padding: 0 0.5rem;
  }
  
  .site-title {
    font-size: 1.125rem;
  }
  
  .site-subtitle {
    font-size: 0.8125rem;
  }
  
  .stat-value {
    font-size: 1.25rem;
  }
}
```

**Also update ReleaseCard.astro styles (create new file with updated responsive CSS):**

Add to `src/components/ReleaseCard.astro` `<style>` block:
```css
/* Mobile responsive adjustments */
@media (max-width: 768px) {
  .release-card {
    padding: 1rem;
  }
  
  .release-title {
    font-size: 1.125rem;
  }
  
  .markdown-body :global(h1) { font-size: 1.5rem; }
  .markdown-body :global(h2) { font-size: 1.25rem; }
  .markdown-body :global(h3) { font-size: 1.125rem; }
  .markdown-body :global(h4) { font-size: 1rem; }
  
  .markdown-body :global(pre) {
    font-size: 0.8125rem;
    padding: 0.75rem;
  }
}

@media (max-width: 480px) {
  .release-card {
    padding: 0.75rem;
    margin-bottom: 1rem;
  }
  
  .release-header {
    flex-wrap: wrap;
  }
  
  .project-name {
    font-size: 0.8125rem;
  }
  
  .project-status {
    font-size: 0.5625rem;
    padding: 0.125rem 0.375rem;
  }
  
  .project-description {
    font-size: 0.8125rem;
  }
  
  .release-title {
    font-size: 1rem;
  }
  
  .markdown-body {
    font-size: 0.9375rem;
  }
  
  .markdown-body :global(pre) {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}

@media (max-width: 320px) {
  .release-card {
    padding: 0.5rem;
    border-radius: 4px;
  }
}
```

**Responsive design principles applied:**
- Mobile-first approach (base styles work on mobile, enhancements for desktop)
- Breakpoints: 768px (tablet), 640px (landscape), 480px (portrait), 320px (minimum)
- Touch targets ≥44px for buttons
- Readable font sizes (minimum 14px body text)
- Horizontal scrolling for code blocks on mobile
- Reduced padding/margins on small screens
- Stats grid collapses to 2 columns → 1 column → stacked list
  </action>
  <verify>
```bash
# Build site
npm run build

# Verify ErrorBanner integration
grep -q "import ErrorBanner" src/pages/index.astro && echo "✅ ErrorBanner imported"
grep -q "ErrorBanner errors" src/pages/index.astro && echo "✅ ErrorBanner used"

# Verify responsive CSS
grep -c "@media" src/pages/index.astro | awk '{if($1>=4) print "✅ Responsive breakpoints added ("$1" media queries)"; else print "❌ Missing responsive CSS"}'

# Check ReleaseCard responsive updates
grep -q "@media" src/components/ReleaseCard.astro && echo "✅ ReleaseCard responsive"
```
  </verify>
  <done>
- ErrorBanner component integrated into index.astro
- Error entries passed to banner (if any exist)
- Responsive CSS added with 4 breakpoints (768px, 640px, 480px, 320px)
- ReleaseCard updated with mobile-friendly styles
- Build succeeds and site is responsive
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Error banner showing failed feeds with dismissible UI, and responsive design working down to 320px mobile width
  </what-built>
  <how-to-verify>
1. **Test error banner (if errors exist):**
```bash
npm run build
npm run preview
```

Open browser to http://localhost:4321

If error banner appears:
- Check yellow background with warning icon
- Click "Show details" button - error list should expand
- Verify error list shows:
  - Project names
  - Feed URLs
  - Error messages with error type
- Click "Hide details" - error list should collapse
- Click dismiss (X) button - banner should disappear
- Refresh page - banner should stay hidden (localStorage)
- Clear localStorage and refresh - banner should reappear

If NO error banner:
- All feeds succeeded - that's good!
- Can't test banner, but build success verifies component exists

2. **Test responsive design:**

**Desktop (1920px):**
- Open DevTools
- Responsive mode (Cmd/Ctrl + Shift + M)
- Set to 1920x1080
- ✅ Stats in 4 columns
- ✅ Release cards have comfortable padding
- ✅ Code blocks readable

**Tablet (768px):**
- Set to 768x1024
- ✅ Stats in 2 columns
- ✅ Fonts slightly smaller
- ✅ Layout still comfortable

**Mobile Landscape (640px):**
- Set to 640x360
- ✅ Stats in 2 columns
- ✅ Smaller header
- ✅ Readable text

**Mobile Portrait (375px - iPhone SE):**
- Set to 375x667
- ✅ Stats in 1 column (stacked)
- ✅ Release cards narrower padding
- ✅ Project status badges visible
- ✅ Code blocks scroll horizontally
- ✅ Touch targets ≥44px

**Small Mobile (320px - iPhone 5):**
- Set to 320x568
- ✅ All content visible (no horizontal scroll on page)
- ✅ Text readable (≥14px)
- ✅ Stats stacked vertically
- ✅ Release cards condensed but readable

3. **Accessibility check:**
- Use keyboard to navigate (Tab key)
- ✅ Can focus on release links
- ✅ Can focus on error banner buttons
- ✅ Can toggle error details with keyboard (Enter/Space)
- ✅ Focus indicators visible

**Expected results:**
- ✅ Error banner appears if feeds failed (yellow, warning style)
- ✅ Banner is dismissible and stays dismissed
- ✅ Error details toggle smoothly
- ✅ Site works on 320px mobile (minimum supported)
- ✅ No horizontal scrolling on mobile (viewport width respected)
- ✅ Touch targets are tappable (≥44px)
- ✅ Code blocks scroll horizontally without breaking layout
  </how-to-verify>
  <resume-signal>
Type "approved" if error banner and responsive design work correctly, or describe any issues (banner not showing, dismiss not working, layout breaks on mobile, text too small)
  </resume-signal>
</task>

</tasks>

<verification>
**Automated checks:**
```bash
# Build verification
npm run build

# Component exists
ls src/components/ErrorBanner.astro

# Responsive CSS present
grep -c "@media" src/pages/index.astro
grep -c "@media" src/components/ReleaseCard.astro
```

**Manual verification (see checkpoint task):**
- Error banner displays and is dismissible
- Responsive design works 320px-1920px
- Touch targets are tappable on mobile
- No horizontal scrolling on narrow viewports

**Requirement coverage:**
- ERR-01: Error banner shows failed feeds ✅
- PERF-04: Responsive design (320px min) ✅
- DISP-03, DISP-04, DISP-05: Project metadata display (maintained from Plan 01) ✅
</verification>

<success_criteria>
1. ✅ Error banner appears when feeds fail (yellow warning style)
2. ✅ Error banner shows project names, URLs, error messages
3. ✅ Error banner is dismissible and stays dismissed (localStorage)
4. ✅ Error details are collapsible (toggle button)
5. ✅ Site is fully usable on 320px mobile devices
6. ✅ No horizontal scrolling on mobile viewports
7. ✅ Touch targets ≥44px on mobile
8. ✅ Text is readable (minimum 14px body text)
9. ✅ Code blocks scroll horizontally without breaking layout
10. ✅ Stats bar collapses appropriately (4 cols → 2 cols → 1 col)
</success_criteria>

<output>
After completion, create `.planning/phases/03-user-interface/03-03-SUMMARY.md` with:
- Error banner implementation details
- localStorage dismiss mechanism
- Responsive breakpoints used (320px, 480px, 640px, 768px)
- Minimum touch target sizes
- Any mobile-specific CSS techniques applied
- Browser compatibility notes for Intersection Observer and localStorage
</output>
