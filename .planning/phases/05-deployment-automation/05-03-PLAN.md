---
phase: 05-deployment-automation
plan: 03
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - src/loaders/rss-loader.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Build output shows progress for each feed being fetched"
    - "Build output shows final statistics (X feeds succeeded, Y failed, Z items processed)"
    - "Developer can see which feeds succeeded/failed during build"
    - "Build completes in <2 minutes even with 100 feeds"
  artifacts:
    - path: "src/loaders/rss-loader.ts"
      provides: "Progress indicators during feed fetching"
      contains: "console.log"
    - path: "src/loaders/rss-loader.ts"
      provides: "Final statistics summary"
      contains: "succeeded.*failed.*items"
  key_links:
    - from: "rss-loader.ts"
      to: "console output"
      via: "logs progress and statistics"
      pattern: "console\\.(log|error)"
---

<objective>
Add build progress indicators and final statistics to the RSS feed loader, providing clear visibility into feed fetching success/failure and performance metrics.

Purpose: Improves developer experience by showing what's happening during build, making it easy to spot feed failures and verify build health without inspecting code or logs manually.

Output: Enhanced build output with progress indicators (e.g., "Fetching feed 42/100: dapr/dapr") and final summary (e.g., "‚úÖ 98 feeds succeeded, ‚ùå 2 failed, üìä 610 items processed").
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/loaders/rss-loader.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Add Progress Indicators to Feed Fetching</name>
  <files>src/loaders/rss-loader.ts</files>
  <action>
Update the RSS loader to add progress logging during feed fetching. Find the section where feeds are fetched (likely in a loop or Promise.allSettled call) and add:

1. **Total count at start:**
```typescript
console.log(`\nüì° Fetching ${feedConfigs.length} CNCF project feeds...\n`);
```

2. **Per-feed progress (if sequential) OR batch summary (if parallel):**
   
If feeds are fetched with `Promise.allSettled()` (parallel - likely):
```typescript
const startTime = Date.now();
const results = await Promise.allSettled(feedPromises);
const duration = ((Date.now() - startTime) / 1000).toFixed(2);
console.log(`\n‚è±Ô∏è  Feed fetching completed in ${duration}s\n`);
```

If feeds are fetched sequentially (less likely):
```typescript
for (let i = 0; i < feedConfigs.length; i++) {
  const feed = feedConfigs[i];
  console.log(`üì° [${i + 1}/${feedConfigs.length}] Fetching ${feed.name || feed.url}...`);
  // ... existing fetch logic
}
```

3. **Error logging for failed feeds:**
```typescript
// After Promise.allSettled results
results.forEach((result, index) => {
  if (result.status === 'rejected') {
    const feed = feedConfigs[index];
    console.error(`‚ùå Failed: ${feed.name || feed.url} - ${result.reason?.message || 'Unknown error'}`);
  }
});
```

**Why this approach:**
- Progress indicators help developers understand build is working (not stuck)
- Per-feed errors make debugging obvious
- Timing info helps track performance regressions
- Emoji prefixes make scanning logs easy (matches existing convention in CONVENTIONS.md)

**Why NOT other approaches:**
- ‚ùå No logging (developers can't see what's happening)
- ‚ùå Verbose per-item logging (too noisy, slows terminal)
- ‚ùå Only final summary (can't debug failures during long builds)
  </action>
  <verify>
Run `npm run build` and check console output includes:
1. "üì° Fetching N CNCF project feeds..." at start
2. "‚è±Ô∏è Feed fetching completed in Xs" after fetching
3. "‚ùå Failed: [feed-name]" for any failed feeds (if applicable)
4. Output appears in logical order (not interleaved/garbled)
  </verify>
  <done>
- Build output shows feed count at start
- Build output shows timing for feed fetching phase
- Build output shows which feeds failed (if any)
- DEV-04 requirement satisfied (build provides clear progress indicators)
  </done>
</task>

<task type="auto">
  <name>Add Final Build Statistics Summary</name>
  <files>src/loaders/rss-loader.ts</files>
  <action>
At the end of the RSS loader (before returning entries), add a summary log:

```typescript
// Calculate statistics
const successCount = results.filter(r => r.status === 'fulfilled').length;
const failureCount = results.filter(r => r.status === 'rejected').length;
const totalItems = entries.length; // Assuming 'entries' is the aggregated array

// Log summary with emoji for scannability
console.log('\nüìä Build Statistics:');
console.log(`   ‚úÖ ${successCount} feeds succeeded`);
if (failureCount > 0) {
  console.log(`   ‚ùå ${failureCount} feeds failed`);
}
console.log(`   üì¶ ${totalItems} release items processed`);
console.log('');

return entries;
```

**Structure:**
- Empty line before summary (visual separation)
- Title with emoji prefix
- Indented metrics for readability
- Conditional failure count (only show if > 0)
- Empty line after (clean terminal output)

**Why this format:**
- Matches emoji convention from CONVENTIONS.md (‚úÖ ‚ùå üìä üì¶)
- Easy to scan in CI logs
- Provides at-a-glance health check
- Shows meaningful metrics (not just "Build complete")

**Why NOT other approaches:**
- ‚ùå JSON format (hard to read in terminal)
- ‚ùå No summary (developers have to count themselves)
- ‚ùå Only success count (hides failures)
  </action>
  <verify>
Run `npm run build` and check console output includes final summary:
1. "üìä Build Statistics:" section appears at end
2. Shows "‚úÖ X feeds succeeded"
3. Shows "‚ùå Y feeds failed" (if any failures)
4. Shows "üì¶ Z release items processed"
5. Summary appears after all other build output (not buried in middle)
  </verify>
  <done>
- Build output shows final statistics with success/failure counts
- Build output shows total items processed
- Statistics appear at end of build in clear, scannable format
- DEV-05 requirement satisfied (build provides summary statistics)
  </done>
</task>

<task type="auto">
  <name>Verify Build Performance Under 2 Minutes</name>
  <files></files>
  <action>
Run a full build and measure total time from start to finish:

```bash
time npm run build
```

Expected timing breakdown (from STATE.md current metrics):
- Feed fetching: ~1.79s (100 feeds in parallel)
- Astro build: ~3.36s (static generation)
- Pagefind indexing: ~0.092s (search index)
- **Total: ~5.2 seconds** (well under 2 minute target)

**What to verify:**
1. Total time < 120 seconds (2 minutes)
2. No individual stage takes > 30 seconds
3. Parallel feed fetching keeps network time low
4. Build output shows timing for main stages

**If build exceeds 2 minutes:**
- Check feed timeout settings (should be ~10s max per feed)
- Verify feeds are fetched in parallel (not sequential)
- Check for network issues (VPN, firewall)

**Why this matters:**
- GitHub Actions free tier: 2000 minutes/month
- Daily builds: 30 runs/month = 60 minutes if 2 min each
- Leaves plenty of buffer for workflow overhead
- Fast builds = fast feedback on failures
  </action>
  <verify>
1. Run `time npm run build`
2. Check total time is < 2 minutes (should be ~5-10 seconds)
3. Verify no warnings about slow feeds or timeouts
4. Check dist/ directory created with all expected files
  </verify>
  <done>
- Build completes in < 2 minutes (currently ~5 seconds)
- PERF-01 requirement satisfied (build completes in <2 minutes)
- Build time leaves margin for 100+ feeds and GitHub Actions overhead
- All statistics and progress indicators working without slowing build
  </done>
</task>

</tasks>

<verification>
**Success criteria met:**
1. ‚úÖ Build shows progress indicators for feed fetching (DEV-04)
2. ‚úÖ Build shows final statistics (success/failure counts, items processed) (DEV-05)
3. ‚úÖ Build completes in <2 minutes (PERF-01)
4. ‚úÖ Failed feeds are clearly identified in output
5. ‚úÖ Timing information helps track performance

**Example output:**
```
üì° Fetching 62 CNCF project feeds...

‚è±Ô∏è  Feed fetching completed in 1.79s

‚ùå Failed: broken-repo/releases - Network timeout

üìä Build Statistics:
   ‚úÖ 61 feeds succeeded
   ‚ùå 1 feeds failed
   üì¶ 610 release items processed
```

**Files changed:**
- src/loaders/rss-loader.ts (added progress and statistics logging)
</verification>

<success_criteria>
Developer running `npm run build` sees clear progress indicators during feed fetching, final statistics showing success/failure counts and items processed, and build completes in under 2 minutes with meaningful feedback throughout.
</success_criteria>

<output>
After completion, create `.planning/phases/05-deployment-automation/05-03-SUMMARY.md`
</output>
