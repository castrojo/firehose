---
phase: 05-deployment-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - astro.config.mjs
  - package.json
  - package-lock.json
autonomous: true

must_haves:
  truths:
    - "npm run build completes without errors"
    - "npm run dev starts local server with live reload"
    - "Build output goes to dist/ directory"
    - "Astro generates static HTML/CSS/JS for GitHub Pages"
  artifacts:
    - path: "astro.config.mjs"
      provides: "Base URL configuration for GitHub Pages subpath"
      contains: "site: 'https://castrojo.github.io'"
    - path: "astro.config.mjs"
      provides: "Base path configuration"
      contains: "base: '/firehose'"
    - path: "package.json"
      provides: "@astrojs/check dependency for build validation"
      exports: ["devDependencies"]
  key_links:
    - from: "package.json build script"
      to: "astro check"
      via: "runs type checking before build"
      pattern: "astro check &&"
    - from: "astro.config.mjs"
      to: "GitHub Pages URL"
      via: "site and base configuration"
      pattern: "castrojo\\.github\\.io/firehose"
---

<objective>
Configure Astro project for GitHub Pages deployment with proper base URL, add missing build dependencies, and verify local development workflow.

Purpose: Establishes correct build configuration so Astro generates static assets with proper paths for the `/firehose` subpath on GitHub Pages, preventing broken links and missing assets.

Output: Working Astro configuration with GitHub Pages base URL, @astrojs/check installed, npm run dev working with live reload.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@package.json
@astro.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Configure Astro for GitHub Pages Deployment</name>
  <files>astro.config.mjs</files>
  <action>
Update astro.config.mjs to add site and base configuration for GitHub Pages:

```javascript
// @ts-check
import { defineConfig } from 'astro/config';

// https://astro.build/config
export default defineConfig({
  site: 'https://castrojo.github.io',
  base: '/firehose',
  vite: {
    build: {
      rollupOptions: {
        external: ['/pagefind/pagefind.js']
      }
    }
  }
});
```

**Why site and base:**
- `site`: Full domain for canonical URLs and sitemap generation
- `base`: Subpath where site is deployed (affects asset paths, links)
- Without these, all links/assets will 404 on GitHub Pages (expects root domain)

**Why NOT other approaches:**
- ❌ Manual path rewriting in components (brittle, error-prone)
- ❌ Custom base path handling (Astro handles this automatically)
  </action>
  <verify>
Run `npm run build` and check that:
1. Build completes without errors
2. Inspect `dist/index.html` - all asset paths start with `/firehose/` (e.g., `<link href="/firehose/_astro/index.abc123.css">`)
3. Inspect `dist/_astro/` directory exists with hashed CSS/JS files
  </verify>
  <done>
- astro.config.mjs contains `site: 'https://castrojo.github.io'`
- astro.config.mjs contains `base: '/firehose'`
- Build succeeds and generates assets with `/firehose/` prefix
  </done>
</task>

<task type="auto">
  <name>Add Missing @astrojs/check Dependency</name>
  <files>package.json, package-lock.json</files>
  <action>
Add @astrojs/check to devDependencies to fix build command:

```bash
npm install --save-dev @astrojs/check
```

**Why needed:**
- `npm run build` runs `astro check` (TypeScript validation)
- Currently fails with "Astro requires the following dependency to be installed: @astrojs/check"
- This is a devDependency (only needed at build time, not runtime)

**Why NOT other approaches:**
- ❌ Removing `astro check` from build script (loses TypeScript validation)
- ❌ Using `--skip-check` flag (defeats purpose of type safety)
  </action>
  <verify>
Run `npm run build` and confirm:
1. No error about missing @astrojs/check
2. TypeScript checking runs (you'll see "Checking..." output)
3. Build completes successfully
  </verify>
  <done>
- package.json devDependencies includes @astrojs/check
- `npm run build` completes without dependency errors
- Type checking runs during build
  </done>
</task>

<task type="auto">
  <name>Test Local Development Server</name>
  <files></files>
  <action>
Verify `npm run dev` works with live reload:

```bash
npm run dev
```

Expected behavior:
1. Dev server starts on http://localhost:4321/firehose/ (note /firehose base path)
2. Opening browser shows the site
3. Logs show: "Local: http://localhost:4321/firehose/"

**Why this validates success:**
- Dev server respects base path configuration
- Live reload works (Astro's built-in HMR)
- Developer can preview changes immediately

**Testing:**
After server starts, edit `src/pages/index.astro` (add a comment), save, and verify browser auto-refreshes (no manual reload needed).

Stop server with Ctrl+C.
  </action>
  <verify>
1. Run `npm run dev`
2. Open http://localhost:4321/firehose/ in browser
3. Verify site loads correctly
4. Make trivial edit to src/pages/index.astro (add comment)
5. Verify browser auto-refreshes without manual reload
6. Stop server with Ctrl+C
  </verify>
  <done>
- `npm run dev` starts server successfully
- Site accessible at http://localhost:4321/firehose/
- Live reload works when files are edited
- DEV-02 requirement satisfied (local preview with live reload)
  </done>
</task>

</tasks>

<verification>
**Success criteria met:**
1. ✅ `npm run build` completes without errors (PERF-01 component)
2. ✅ `npm run dev` starts with live reload (DEV-02)
3. ✅ Assets have correct `/firehose/` base path for GitHub Pages
4. ✅ Type checking runs during build (@astrojs/check installed)

**Files changed:**
- astro.config.mjs (added site and base)
- package.json (added @astrojs/check)
- package-lock.json (updated by npm)
</verification>

<success_criteria>
Developer can run `npm run build` successfully, `npm run dev` for local preview with live reload, and generated assets have correct paths for GitHub Pages deployment to https://castrojo.github.io/firehose/.
</success_criteria>

<output>
After completion, create `.planning/phases/05-deployment-automation/05-01-SUMMARY.md`
</output>
