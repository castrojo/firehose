# JSON Schema for Go → Astro Data Handoff

**Purpose:** Define the contract between the Go data pipeline and Astro frontend  
**Format:** JSON (pretty-printed for git diffs)  
**Location:** `src/data/releases.json` (generated by Go, consumed by Astro)  
**Last Updated:** February 2, 2026

## Overview

The hybrid architecture splits responsibilities:
- **Go:** Fetch feeds, parse Landscape, enrich data, validate, output JSON
- **Astro:** Import JSON, render UI with existing components

This schema defines the JSON structure that Go writes and Astro reads.

## Root Schema

```json
{
  "metadata": { ... },
  "releases": [ ... ],
  "feeds": [ ... ]
}
```

### Top-Level Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `metadata` | `Metadata` | Yes | Build metadata and statistics |
| `releases` | `Release[]` | Yes | Array of all release entries (sorted by pubDate desc) |
| `feeds` | `FeedStatus[]` | Yes | Status of each feed fetch (for debugging) |

## Metadata Object

Contains build metadata and statistics for monitoring and debugging.

```json
{
  "metadata": {
    "schemaVersion": "1.0.0",
    "generatedAt": "2026-02-02T10:15:30Z",
    "generatedBy": "firehose-go v1.0.0",
    "buildDuration": "4.523s",
    "stats": {
      "feedsTotal": 231,
      "feedsSuccessful": 230,
      "feedsFailed": 1,
      "feedsSkipped": 0,
      "releasesTotal": 612,
      "landscapeProjectsTotal": 867,
      "landscapeProjectsMatched": 160
    },
    "performance": {
      "landscapeFetchDuration": "0.842s",
      "feedsFetchDuration": "3.215s",
      "enrichmentDuration": "0.310s",
      "validationDuration": "0.089s",
      "outputDuration": "0.067s"
    }
  }
}
```

### Metadata Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `schemaVersion` | `string` | Yes | Schema version (semver), allows Astro to detect breaking changes |
| `generatedAt` | `string` (ISO 8601) | Yes | Build timestamp (UTC) |
| `generatedBy` | `string` | Yes | Go binary version (e.g., "firehose-go v1.0.0") |
| `buildDuration` | `string` | Yes | Total build time (e.g., "4.523s") |
| `stats` | `Stats` | Yes | Aggregate statistics |
| `performance` | `Performance` | Yes | Performance breakdown by stage |

### Stats Object

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `feedsTotal` | `int` | Yes | Total feeds configured (from feeds.yaml) |
| `feedsSuccessful` | `int` | Yes | Feeds that loaded successfully |
| `feedsFailed` | `int` | Yes | Feeds that failed (network, parse, validation errors) |
| `feedsSkipped` | `int` | Yes | Feeds intentionally skipped (e.g., disabled in config) |
| `releasesTotal` | `int` | Yes | Total release entries across all successful feeds |
| `landscapeProjectsTotal` | `int` | Yes | Total projects in CNCF Landscape (from landscape.yml) |
| `landscapeProjectsMatched` | `int` | Yes | Projects matched to feeds (enriched with metadata) |

### Performance Object

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `landscapeFetchDuration` | `string` | Yes | Time to fetch and parse landscape.yml |
| `feedsFetchDuration` | `string` | Yes | Time to fetch all feeds (parallel) |
| `enrichmentDuration` | `string` | Yes | Time to enrich entries with Landscape metadata |
| `validationDuration` | `string` | Yes | Time to validate all entries |
| `outputDuration` | `string` | Yes | Time to marshal and write JSON file |

## Release Object

Represents a single release entry from an RSS/Atom feed, enriched with CNCF Landscape metadata.

```json
{
  "id": "https://github.com/kubernetes/kubernetes/releases/tag/v1.29.0",
  "title": "v1.29.0",
  "link": "https://github.com/kubernetes/kubernetes/releases/tag/v1.29.0",
  "pubDate": "2024-02-01T12:00:00Z",
  "content": "# Changelog\n\n## Major Changes...",
  "contentSnippet": "Changelog Major Changes...",
  "guid": "tag:github.com,2024:Repository/123456/v1.29.0",
  "projectName": "Kubernetes",
  "projectDescription": "Production-Grade Container Orchestration",
  "projectStatus": "graduated",
  "projectHomepage": "https://kubernetes.io",
  "feedUrl": "https://github.com/kubernetes/kubernetes/releases.atom",
  "feedTitle": "Release notes from kubernetes",
  "feedStatus": "success",
  "fetchedAt": "2026-02-02T10:15:27Z"
}
```

### Release Fields

| Field | Type | Required | Source | Description |
|-------|------|----------|--------|-------------|
| `id` | `string` | Yes | RSS guid or link | Unique identifier (used by Astro for keying) |
| `title` | `string` | Yes | RSS title | Release version or title (e.g., "v1.29.0") |
| `link` | `string` (URL) | Yes | RSS link | GitHub release URL |
| `pubDate` | `string` (ISO 8601) | Yes | RSS pubDate | Publication date (UTC) |
| `content` | `string` | No | RSS content:encoded | Full release notes (markdown) |
| `contentSnippet` | `string` | No | RSS description | Plain text excerpt (first 280 chars) |
| `guid` | `string` | No | RSS guid | RSS feed GUID |
| `projectName` | `string` | No | Landscape | Canonical CNCF project name (e.g., "Kubernetes") |
| `projectDescription` | `string` | No | Landscape | Short project description from CNCF |
| `projectStatus` | `string` (enum) | No | Landscape | CNCF maturity: "graduated", "incubating", "sandbox" |
| `projectHomepage` | `string` (URL) | No | Landscape | Project homepage URL |
| `feedUrl` | `string` (URL) | Yes | Feed config | Source feed URL (for debugging) |
| `feedTitle` | `string` | No | RSS channel/title | Feed title from RSS (e.g., "Release notes from kubernetes") |
| `feedStatus` | `string` (enum) | Yes | Pipeline | "success" or "error" (for monitoring) |
| `fetchedAt` | `string` (ISO 8601) | Yes | Pipeline | When this feed was fetched (UTC) |

### Field Notes

**Required Fields:**
- `id`, `title`, `link`, `pubDate`, `feedUrl`, `feedStatus`, `fetchedAt` are ALWAYS present
- These match Zod schema validation in `src/lib/schemas.ts:FeedEntrySchema`

**Optional Fields:**
- `content` may be empty for feeds without release notes
- `projectName` / `projectDescription` / `projectStatus` / `projectHomepage` only present if feed matched to CNCF Landscape
- ~160 of 231 feeds have Landscape enrichment (69%)
- Non-matched feeds fallback to `feedTitle` for display

**Sorting:**
- Array is sorted by `pubDate` descending (newest first)
- Astro can rely on this ordering

## FeedStatus Object

Tracks the status of each feed fetch for monitoring and debugging.

```json
{
  "feedUrl": "https://github.com/kubernetes/kubernetes/releases.atom",
  "status": "success",
  "entriesCount": 12,
  "fetchedAt": "2026-02-02T10:15:27Z",
  "duration": "0.523s"
}
```

**Or for failed feeds:**

```json
{
  "feedUrl": "https://github.com/invalid/repo/releases.atom",
  "status": "error",
  "error": "HTTP 404: Not Found",
  "errorType": "network",
  "fetchedAt": "2026-02-02T10:15:28Z",
  "duration": "0.102s"
}
```

### FeedStatus Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `feedUrl` | `string` (URL) | Yes | Feed URL from config |
| `status` | `string` (enum) | Yes | "success" or "error" |
| `entriesCount` | `int` | Success only | Number of releases found in feed |
| `error` | `string` | Error only | Human-readable error message |
| `errorType` | `string` (enum) | Error only | "network", "parse", "validation", "timeout" |
| `fetchedAt` | `string` (ISO 8601) | Yes | When fetch was attempted (UTC) |
| `duration` | `string` | Yes | Time spent fetching this feed (e.g., "0.523s") |

### Error Types

| Type | Description | Example |
|------|-------------|---------|
| `network` | HTTP errors (404, 403, 500, etc.) | "HTTP 404: Not Found" |
| `parse` | RSS/Atom parsing failed | "Invalid XML: unexpected token" |
| `validation` | Data failed schema validation | "Missing required field: link" |
| `timeout` | Request exceeded timeout | "Timeout after 30s" |

## Complete Example

```json
{
  "metadata": {
    "schemaVersion": "1.0.0",
    "generatedAt": "2026-02-02T10:15:30Z",
    "generatedBy": "firehose-go v1.0.0",
    "buildDuration": "4.523s",
    "stats": {
      "feedsTotal": 231,
      "feedsSuccessful": 230,
      "feedsFailed": 1,
      "feedsSkipped": 0,
      "releasesTotal": 612,
      "landscapeProjectsTotal": 867,
      "landscapeProjectsMatched": 160
    },
    "performance": {
      "landscapeFetchDuration": "0.842s",
      "feedsFetchDuration": "3.215s",
      "enrichmentDuration": "0.310s",
      "validationDuration": "0.089s",
      "outputDuration": "0.067s"
    }
  },
  "releases": [
    {
      "id": "https://github.com/kubernetes/kubernetes/releases/tag/v1.29.0",
      "title": "v1.29.0",
      "link": "https://github.com/kubernetes/kubernetes/releases/tag/v1.29.0",
      "pubDate": "2024-02-01T12:00:00Z",
      "content": "# Changelog\n\n## Major Changes\n- Feature 1\n- Feature 2",
      "contentSnippet": "Changelog Major Changes Feature 1 Feature 2",
      "guid": "tag:github.com,2024:Repository/123456/v1.29.0",
      "projectName": "Kubernetes",
      "projectDescription": "Production-Grade Container Orchestration",
      "projectStatus": "graduated",
      "projectHomepage": "https://kubernetes.io",
      "feedUrl": "https://github.com/kubernetes/kubernetes/releases.atom",
      "feedTitle": "Release notes from kubernetes",
      "feedStatus": "success",
      "fetchedAt": "2026-02-02T10:15:27Z"
    },
    {
      "id": "https://github.com/dapr/dapr/releases/tag/v1.12.0",
      "title": "Dapr Runtime v1.12.0",
      "link": "https://github.com/dapr/dapr/releases/tag/v1.12.0",
      "pubDate": "2024-01-30T08:30:00Z",
      "content": "This release includes...",
      "projectName": "Dapr",
      "projectDescription": "Event-driven, portable runtime for building microservices",
      "projectStatus": "incubating",
      "projectHomepage": "https://dapr.io",
      "feedUrl": "https://github.com/dapr/dapr/releases.atom",
      "feedTitle": "Release notes from dapr",
      "feedStatus": "success",
      "fetchedAt": "2026-02-02T10:15:26Z"
    }
  ],
  "feeds": [
    {
      "feedUrl": "https://github.com/kubernetes/kubernetes/releases.atom",
      "status": "success",
      "entriesCount": 12,
      "fetchedAt": "2026-02-02T10:15:27Z",
      "duration": "0.523s"
    },
    {
      "feedUrl": "https://github.com/dapr/dapr/releases.atom",
      "status": "success",
      "entriesCount": 8,
      "fetchedAt": "2026-02-02T10:15:26Z",
      "duration": "0.412s"
    },
    {
      "feedUrl": "https://github.com/invalid/repo/releases.atom",
      "status": "error",
      "error": "HTTP 404: Not Found",
      "errorType": "network",
      "fetchedAt": "2026-02-02T10:15:28Z",
      "duration": "0.102s"
    }
  ]
}
```

## File Size Considerations

**Current Astro Content Collection:**
- Data store: `.astro/data-store.json` (~7.1MB, not committed)
- 612 releases × ~11KB average = ~6.7MB

**Expected JSON File Size:**
- Similar: ~6-8MB (pretty-printed JSON)
- Compresses well: ~500KB gzipped

**Git LFS Decision:**
- If `releases.json` > 50MB → Use Git LFS
- Current size: ~7MB → Commit directly
- GitHub Pages handles this fine

**Optimization Options (if needed):**
1. Minify JSON (no pretty-print) → ~4MB
2. Limit to last N releases per project
3. Separate into chunks (e.g., by project status)
4. Use compression (gzip)

**Recommendation:** Start with pretty-printed JSON (~7MB) for debuggability. Optimize only if needed.

## Go Implementation Notes

### Struct Tags

```go
type Release struct {
    ID                  string    `json:"id" validate:"required"`
    Title               string    `json:"title" validate:"required"`
    Link                string    `json:"link" validate:"required,url"`
    PubDate             time.Time `json:"pubDate" validate:"required"`
    Content             string    `json:"content,omitempty"`
    ContentSnippet      string    `json:"contentSnippet,omitempty"`
    GUID                string    `json:"guid,omitempty"`
    ProjectName         string    `json:"projectName,omitempty"`
    ProjectDescription  string    `json:"projectDescription,omitempty"`
    ProjectStatus       string    `json:"projectStatus,omitempty" validate:"omitempty,oneof=graduated incubating sandbox"`
    ProjectHomepage     string    `json:"projectHomepage,omitempty" validate:"omitempty,url"`
    FeedURL             string    `json:"feedUrl" validate:"required,url"`
    FeedTitle           string    `json:"feedTitle,omitempty"`
    FeedStatus          string    `json:"feedStatus" validate:"required,oneof=success error"`
    FetchedAt           time.Time `json:"fetchedAt" validate:"required"`
}
```

### JSON Marshaling

```go
// Pretty-print for git diffs
encoder := json.NewEncoder(file)
encoder.SetIndent("", "  ")
encoder.SetEscapeHTML(false) // Keep URLs readable
if err := encoder.Encode(output); err != nil {
    return fmt.Errorf("marshal JSON: %w", err)
}
```

### Validation

Use `github.com/go-playground/validator/v10`:

```go
validate := validator.New()
for _, release := range releases {
    if err := validate.Struct(release); err != nil {
        // Log validation errors
        log.Warn("Invalid release", "id", release.ID, "error", err)
    }
}
```

## Astro Consumption

### Import JSON

```typescript
// src/pages/index.astro
import releasesData from '../data/releases.json';

const { metadata, releases, feeds } = releasesData;

// Filter/sort/slice as needed
const displayReleases = releases.slice(0, 100); // First 100 for infinite scroll
```

### Type Safety

```typescript
// src/types/releases.ts
export interface ReleasesData {
  metadata: {
    schemaVersion: string;
    generatedAt: string;
    generatedBy: string;
    buildDuration: string;
    stats: {
      feedsTotal: number;
      feedsSuccessful: number;
      feedsFailed: number;
      feedsSkipped: number;
      releasesTotal: number;
      landscapeProjectsTotal: number;
      landscapeProjectsMatched: number;
    };
    performance: {
      landscapeFetchDuration: string;
      feedsFetchDuration: string;
      enrichmentDuration: string;
      validationDuration: string;
      outputDuration: string;
    };
  };
  releases: Release[];
  feeds: FeedStatus[];
}

export interface Release {
  id: string;
  title: string;
  link: string;
  pubDate: string;
  content?: string;
  contentSnippet?: string;
  guid?: string;
  projectName?: string;
  projectDescription?: string;
  projectStatus?: 'graduated' | 'incubating' | 'sandbox';
  projectHomepage?: string;
  feedUrl: string;
  feedTitle?: string;
  feedStatus: 'success' | 'error';
  fetchedAt: string;
}

export interface FeedStatus {
  feedUrl: string;
  status: 'success' | 'error';
  entriesCount?: number;
  error?: string;
  errorType?: 'network' | 'parse' | 'validation' | 'timeout';
  fetchedAt: string;
  duration: string;
}
```

### Existing Components Work As-Is

All existing Astro components (`ReleaseCard.astro`, `FilterBar.astro`, `SearchBar.astro`, etc.) continue working because the Release object matches the existing `FeedEntry` type from `src/lib/schemas.ts`.

## Schema Versioning

**Initial version:** `1.0.0`

**Breaking changes** (bump major version):
- Remove required field
- Change field type
- Rename field
- Change enum values

**Non-breaking changes** (bump minor version):
- Add optional field
- Add new enum value (as long as old values still valid)
- Add new top-level key

**Astro compatibility check:**

```typescript
if (metadata.schemaVersion.split('.')[0] !== '1') {
  throw new Error(`Incompatible schema version: ${metadata.schemaVersion}`);
}
```

## Testing

### Go Unit Tests

```go
func TestMarshalRelease(t *testing.T) {
    release := Release{
        ID:         "https://example.com/release/v1.0.0",
        Title:      "v1.0.0",
        Link:       "https://example.com/release/v1.0.0",
        PubDate:    time.Now(),
        FeedURL:    "https://example.com/feed.atom",
        FeedStatus: "success",
        FetchedAt:  time.Now(),
    }
    
    data, err := json.Marshal(release)
    require.NoError(t, err)
    
    var unmarshaled Release
    err = json.Unmarshal(data, &unmarshaled)
    require.NoError(t, err)
    
    assert.Equal(t, release.ID, unmarshaled.ID)
    assert.Equal(t, release.Title, unmarshaled.Title)
}
```

### Integration Test

1. Run Go pipeline to generate JSON
2. Run Astro build with generated JSON
3. Compare rendered output with current Astro Content Layer build
4. Verify all 231 feeds processed
5. Verify Landscape enrichment matches

## References

- Current Zod schemas: `src/lib/schemas.ts`
- Data flow documentation: `.planning/codebase/DATAFLOW.md`
- Current Astro usage: `src/pages/index.astro` (lines 27-40)
- Feed loader logic: `src/lib/feed-loader.ts` (enrichEntry function)
